<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [bautajs][1]
-   [How to install][2]
-   [Features][3]
    -   [Request Validation][4]
    -   [datasources][5]
    -   [multipart/related requests][6]
    -   [multipart/form-data requests][7]
    -   [Request like features][8]
    -   [Debug][9]
    -   [LoopbackFilters][10]
    -   [API versioning][11]
    -   [Set an Operation schema (endpoint schema)][12]
-   [Decorators][13]
    -   [Usage][14]
    -   [request][15]
        -   [Parameters][16]
        -   [Examples][17]
    -   [compileDataSource][18]
        -   [Parameters][19]
        -   [Examples][20]
-   [Public API][21]
    -   [BautaJS][22]
        -   [Parameters][23]
        -   [Examples][24]
        -   [logger][25]
            -   [Properties][26]
        -   [requireAll][27]
            -   [Parameters][28]
            -   [Examples][29]
        -   [services][30]
            -   [Properties][31]
    -   [Artifacts][32]
        -   [Operation][33]
            -   [Parameters][34]
            -   [apiDefinition][35]
                -   [Properties][36]
            -   [dataSource][37]
                -   [Properties][38]
            -   [exec][39]
                -   [Parameters][40]
                -   [Examples][41]
            -   [operationId][42]
                -   [Properties][43]
            -   [push][44]
                -   [Parameters][45]
                -   [Examples][46]
            -   [run][47]
                -   [Parameters][48]
            -   [schema][49]
                -   [Properties][50]
            -   [serviceId][51]
                -   [Properties][52]
            -   [setErrorHandler][53]
                -   [Parameters][54]
                -   [Examples][55]
            -   [setSchema][56]
                -   [Parameters][57]
                -   [Examples][58]
            -   [validateRequest][59]
                -   [Parameters][60]
                -   [Examples][61]
            -   [validateResponse][62]
                -   [Parameters][63]
                -   [Examples][64]
        -   [Step][65]
            -   [Parameters][66]
            -   [handleValue][67]
                -   [Parameters][68]
            -   [run][69]
                -   [Parameters][70]
            -   [runWithCallback][71]
                -   [Parameters][72]
            -   [runWithReturn][73]
                -   [Parameters][74]
        -   [Service][75]
            -   [Parameters][76]
        -   [Version][77]
            -   [Parameters][78]
            -   [addOperation][79]
                -   [Parameters][80]
                -   [Examples][81]
            -   [push][82]
                -   [Parameters][83]
                -   [Examples][84]
        -   [Logger][85]

## bautajs

A library to build easy versionable and self organized middlewares.


## How to install

Make sure that you have access to [Artifactory][86]

```console
  npm install bautajs
```


## Features




### Request Validation

`bautajs` comes with a default request validation using the [openAPI schema][87]. By default, it is set to true.
This feature is always enabled while you have a valid openAPI schema inputs. To disable it for one endpoint just add validateRequest to false inside the path definition.

### Example

  This is a path schema example:

```json
{
  "/test":{
    "get":{
      "validateRequest": false,
      "parameters": [
      {
        "name": "limit",
        "in": "query",
        "description": "How many items to return at one time (max 100)",
        "required": false,
        "schema": {
          "type": "integer",
          "format": "int32"
        }
      }
     ]
    }
  }
}
```

  Alternative you can also validate inside every resolver by accesing to the context `ctx.validate()`.

```js
  services.cats.v1.find.push(function pFn(_, ctx) {
    const error = ctx.validate();
    if(error) {
      throw error;
    }
  })
```


### datasources

The datasources are the main feature of the library. The dataSources define how the services will behave and from where the data will come.

### Define a datasource

To define a datasource, create a file into `"services/"` folder with a name ending on `"-datasource.json|js"`. The datasources are loaded automatically by the `bautajs` in bootstrap time.
A datasource containing a `url` property on its definition, represents a HTTP request (using [Got][88]).           

`By default request are done using [keepAlive](https://nodejs.org/api/http.html#http_new_agent_options)`

Without `url`, a datasource just describe an simple service operation.

### Datasource structure

`bautajs` datasources must be compliant with [./lib/validators/datasource-schema.json][89].

### Example

This is a datasource example:

```json
{
  "testService":{
    "operations":[
      {
        "name":"test",
        "url":"http://myserver.com",
        "options":{
          "json": true,
          "headers": {
            "Accept":"application-json"
          }
        }
      }
    ]
  }
}
```

### Dynamic datasources

Datasources used in every request are compiled on demand. It allow to add dynamic information into them, specifying properties from `req`, `config` and `env` (environment variables) objects. 
See the template syntax format at [stjs][90].
to retrieve dynamic data.

```json
{
  "testService":{
    "operations":[
      {
        "name":"test",
        "url":"{{config.url}}",
        "options":{
          "json": true,
          "headers": {
            "Accept-Language": [{
              "{{#if !req.headers.accept-language}}": 'my default lang',
              "{{#else}}":"{{req.headers.accept-language}}"
            }]",
            "x-axa-user-agent": "{{req.headers.x-axa-user-agent}}"
          }
        }
      }
    ]
  }
}
```

`Once the dynamic data is resolved, the fields with`undefined`or`null\` values, are removed from the request as [got definitions][88].

### Accessing compiled datasources from my resolvers (steps)

Is possible to access to compiled datasources from the operations resolvers.

```js
  const compileDataSource = require('bautajs/decorators/compile-datasource');

  // Launching the operation datasource request.
  services.cats.v1.find.push(compileDataSource((_, ctx) => {
    return ctx.dataSource.request();
  }));
  // Launching the operation datasource request with custom option.
  // They will be merged with the definition options.
  services.cats.v1.find.push(compileDataSource((_, ctx) => {
    const customOptions = { json: false };
    return ctx.dataSource.request(customOptions);
  }));
```

```js
  // Launching other operation datasource request
  services.cats.v1.find.push((_, ctx) => {
    return services.documents.v1.find.dataSource(ctx.req).request();
  });
```

By default, `bautajs`, uses [got][88] library to launch the operation datasources requests.
However, is possible to use your preferred request module using the datasources definitions.

```js
  const request = require('request');
  services.cats.v1.find.push((_, ctx, cb) =>{
    const { method, url, options } = ctx.dataSource(ctx.req);

    return request({ method, url, ...options }, cb);
  });
```


### multipart/related requests

[got][88] do not come with `multipart/related` out of the box.
Thus, `bautajs` add it to be available at the operations datasources requests.
`bautajs` follows the way [request/request][91] implements `multipart/related` by using [multipart-request-builder][92].

```text
  Do not add the multipart configuration in the operation datasource definition if it has streams (fs.createReadStream).
  It must be passed in the resolver definition
```

```json
// my-datasource.json
// multipart/related without streams
{
  "testService": {
    "operations":  [
      {
        "name": "operation1",
        "headers": {
          "content-type": "multipart/related"
        },
        "preambleCRLF": true,
        "postambleCRLF": true
      }
    ]
  }
} 
```

```js
const compileDataSource = require('bautajs/decorators/compile-datasource');
// my-resolver.js
// multipart/related with stream
services.testService.v1.operation1.setLoader(compileDataSource((_, ctx) =>{
  return ctx.dataSource.request({
    multipart: [
      {
        'content-type': 'application/json',
        body: JSON.stringify({
          foo: 'bar',
          _attachments: {
            'message.txt': {
              follaws: true,
              length: 18,
              'content_type': 'text/plain'
            }
          }
        })
      },
      {
        body: 'I am an attachment'
      },
      {
        body: fs.createReadStream('image.png')
      }
    ],
    // alternatively pass an object containing additional options multipart: {
    chunked: false,
    data: [
      {
        'content-type': 'application/json',
        body: JSON.stringify({
          foo: 'bar',
          _attachments: {
            'message.txt': {
              follows: true,
              length: 18,
              'content_type': 'text/plain'
            }
          }
        })
      },
      {
        body: 'I am an attachment'
      }
    ]
  }})
}))
```


### multipart/form-data requests

As for `multipart/related`, `bautajs` provides its own implementation for `multipart/form-data`.

```text
  Do not add the multipart configuration in the operation datasource definition if it has streams (fs.createReadStream).
  It must be passed in the resolver definition
```

```json
// my-datasource.json
// multipart/related without streams
{
  "testService": {
    "operations":  [
      {
        "name": "operation1"
      }
    ]
} 
```

```js
// my-resolver.js
// multipart/related with streams
services.testService.v1.operation1.setLoader(compileDataSource((_, ctx) => {
  const formData = {
    // Pass a simple key-value pair
    my_field: 'my_value',
    // Pass data via Buffers
    my_buffer: Buffer.from([1, 2, 3]),
    // Pass data via Streams
    my_file: fs.createReadStream(__dirname + '/unicycle.jpg'),
    // Pass multiple values /w an Array
    attachments: [
      fs.createReadStream(__dirname + '/attachment1.jpg'),
      fs.createReadStream(__dirname + '/attachment2.jpg')
    ],
    // Pass optional meta-data with an 'options' object with style: {value: DATA, options: OPTIONS}
    // Use case: for some types of streams, you'll need to provide "file"-related information manually.
    // See the `form-data` README for more information about options: https://github.com/form-data/form-data
    file: {
      value:  fs.createReadStream('/file'),
      options: {
        filename: 'someImage.jpg',
        contentType: 'image/jpeg'
      }
    }
  };
  return ctx.dataSource.request({ formData });
}));
```


### Request like features

To help on the transition from `request` to `got`, there are some alias and helpfull fields that feels like still using request library:

-   Use 'json' as an object to POST json data (content-type: application/json):

```json
  {
    "json": {
      "someFiled":"someValue"
    }
  }
```

-   Use 'form' as an object to POST data as url encoded form (content-type:application/x-www-form-urlencoded):

```json
  {
    "form": {
      "someFiled":"someValue"
    }
  }
```

-   Custom `Agent` allowing the following features:
    -   http_proxy and https_proxy environment variables
    -   Request using custom certificates throught 'cert' and 'key' native NODEJS fields
    -   StricSSL enable throught 'rejectUnauthorized' field


### Debug

One of the main purpose of `bautajs` is provide a nice debugging experience. 
The request options, the response body and the times a request takes are logged.
To activate the logs just set debug:

```cmd
LOG_LEVEL=debug DEBUG=bautajs*
```

Furthemore, if you want to censor some words we strongly recomend use [pino redaction][93]


### LoopbackFilters

The `bautajs` allows to use [loopback filters][94] over arrays.
Add the applyLoopbackFilters option to datasource operations:

### Example

```json
{
  "testService":{
    "operations":[
      {
        "name":"test",
        "url":"http://myserver.com",
        "applyLoopbackFilters": true,
        "options":{
          "json": true
        }
      }
    ]
  }
}
```

Given the received data:

```json
[
  {
    "code":"foo"
  },
  {
    "code":"bar"
  }
]
```

Applying the given filter `?filter[where][code]=foo`, the result will be:

```json
[
  {
    "code":"foo"
  }
]
```


### API versioning

The `bautajs` has API versioning out of the box to version the services and datasources easily.

### API definition

The API definition is where are defined API versions, see [./lib/validators/api-definition-schema.json][95]

### Example

This is an example of API definitions for two API versions:

```json
// api-definitions.json
[
  {
    "openapi": "3.0.0",
    "apiVersion": "1.0",
    "info": {
      "description": "A new API",
      "version": "v1",
      "title": "CORE API"
    },
    "servers": [
      {
        "url":"/v1/api/"
     }
    ]
  },
  {
    "openapi": "3.0.0",
    "apiVersion": "2.0",
    "info": {
      "description": "A new API",
      "version": "v2",
      "title": "CORE API"
    },
    "servers": [
      {
        "url":"/v1/api/"
     }
    ]
  }
]
```

API versions are accesible by code too:

```js
// my-resolver.js
module.exports = (services) => {
  services.cats.v1.find.exec();
  services.cats.v2.find.exec();
}
```

In this example the `cats.v2` is inheriting automatically the behaviour of `cats.v1`

### Example of no inheritance

This is an example of API definitions for two API versions without inheritance:

-   Using the previous example api-definitions.json, we can specify on the v2 data source what we don't want to inherit:

```json
// v2-datasource.json
{
  "cats": {
    "operations": [
      {
        "id":"find",
        "inherit": false
      }
    ]
  }
}
```

Then the two versions will have a different behaviour:

```js
// my-resolver.js
module.exports = (services) => {
  services.cats.v1.find.exec();
  services.cats.v2.find.exec(); // The result of this will be different from the v1
}
```

### Example of different datasources by version

This is an example of API definitions for two API versions without inheritance:

This will be the datasource for the different versions:

```json
{
  "cats":{
    "operations":[
      {
        "name":"find",
        "url":"http://google.es"
      },
      {
        "name":"find",
        "url":"http://facebook.es",
        "version":"v2"
      }
    ]
  }
}
```

So as you can see here the v1 `cats.find` will fetch the data from google.es and v2 will fetch data from facebook.com.
Datasources without `version` will be linked to the first api-definition version. Also, `version` must match with the API definition `info.version`.


### Set an Operation schema (endpoint schema)

bautajs provides the way to associate an [OPENAPI][96] definition to one operation. Later this
will have multiple uses:

-   As an input validation if the option validateRequest is set to true or if the `this.validate()` function is called inside the resolver.
-   To expose the service through an API endpoint.
-   To add the endpoint on the swagger explorer
-   Your imagination ;)

Take in account you can access to the definitions set when you create the bautajs instance on your API definition under definions field, that way
you are hable to share schema definitions between operation schemas.

Example:
my-schema.json

```json
  {
    "/cats/{catId}": {
      "get": {
        "tags": ["cats"],
        "summary": "Get cats by id",
        "parameters": [
          {
            "in": "path",
            "name": "catId",
            "required": true,
            "type": "string",
            "description": "The identifier of the cat"
        ],
        "operationId": "get-cats-catsId",
        "produces": ["application/json"],
        "responses": {
          "201": {
            "schema": {
              "$ref": "#/definitions/Cat"
            }
          },
          "401": {
            "description": "Not authorized",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          },
          "422": {
            "description": "Unprocessable entity",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          },
          "500": {
            "description": "Internal server error.",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        }
      }
    }
  }
```

some-resolver.js

```js
  const mySchema = require('./my-schema.json')
  module.exports = (services) => {
      services.myService.v1.find.setSchema(mySchema)
  }
```


## Decorators

A set of decorators to be used as a helpers of your resolvers


### Usage

To access to the decorators you just have to import them one by one:

```js
  const compileDataSource = require('bautajs/decorators/compile-datasource');

  services.v1.cats.op1.push(compileDataSource((_, ctx) => {
    return ctx.dataSource.request();
  }));
```


### request

Compile the data source and do a request to the operation service

#### Parameters

-   `options` **[Object][97]** the got request options

#### Examples

```javascript
const request = require('batuajs/decorators/request');

services.v1.test.op1.push(request())
```

### compileDataSource

Compile the ctx data source with the given request, resolving all the data source variables
In your function you can access to the compiled data source throught ctx.dataSource and do a request using
ctx.dataSource.request();

#### Parameters

-   `fn` **[function][98]** the function to execute after compile the data source

#### Examples

```javascript
const compileDataSource = require('batuajs/decorators/compile-datasource');

services.v1.test.op1.push(compileDataSource((_, ctx) => {
  return ctx.dataSource.request();
}))
```

## Public API




### BautaJS

Build the BautaJS services with the given dataSources and resolvers.
This services could be accessible from the instance .services after the initialization.

#### Parameters

-   `apiDefinitions` **([Array][99]&lt;[Object][97]> | [Object][97])** An array of [OpenAPI 3.0/2.0][100] definitions. See the valid schema @see [./lib/validators/api-definition-schema-json][101].
-   `options` **[Object][97]?** 
    -   `options.dataSourcesPath` **([string][102] \| [Array][99]&lt;[string][102]>)** A [node-glob][103] path to your dataSources. (optional, default `'./server/services/../..-datasource.?(js|json)'`)
    -   `options.resolversPath` **([string][102] \| [Array][99]&lt;[string][102]>)** A [node-glob][103] path to your resolvers definitions. (optional, default `'./server/services/../..-resolver.js'`)
    -   `options.dataSourceCtx` **any** Object to be injected on the dataSources in run time (optional, default `{}`)

#### Examples

```javascript
const Bautajs = require('bautajs');
const apiDefinitions = require('./open-api-definition.json');
const ctx = {
  someProp: 'someVal'
};

const bautaJS = new Bautajs(apiDefinitions, {
 // Load all the files with datasource in the file name
 dataSourcesPath: './services/*-datasource.?(js|json)',
 resolversPath:  './services/*-resolver.js',
 dataSourceCtx: ctx
});

// Assuming we have a dataSource for cats, once bautajs is initialized, you can execute the operation with the following code:
await bautaJS.services.cats.v1.find.exec({});
```

#### logger

##### Properties

-   `logger` **[Logger][104]** A [debug][https://www.npmjs.com/package/debug][105] logger instance

#### requireAll

Require a bunch of files that matches the given [glob][103] path.

##### Parameters

-   `folder` **([string][102] \| [Array][99]&lt;[string][102]>)** the given folder magic path, see [https://github.com/isaacs/node-glob][103]
-   `execute` **[boolean][106]** execute the required files with the given vars if they are functions (optional, default `true`)
-   `vars` **[Object][97]?** optional variables to add as a parameter on the file execution (optional, default `{}`)

##### Examples

```javascript
const { requireAll } = require('bautajs');

const files = requireAll('./my/path/to/datasources/*.js', true, {someVar:123});
```

Returns **[Array][99]&lt;any>** array of required files

#### services

##### Properties

-   `services` **[Object][97]&lt;[string][102], [Service][107]>** A services dictionary containing all the created services

### Artifacts

A set of artifacts that bautajs provides when use its public API


#### Operation

An operation can be translated as an datasource function that can be used
every where to execute a flow of loaders and hooks.

##### Parameters

-   `id` **[string][102]** the id of the operation
-   `steps` **[Array][99]&lt;[function][98]>** an array of steps to add to the operation
-   `dataSourceTemplate` **[Object][97]** the operation datasource template definition, contains all the request data
-   `apiDefinition` **[Object][97]** An [OpenAPI][87] definition.
-   `serviceId` **[Object][97]?** the service name of the operation, only used for log purposes

##### apiDefinition

###### Properties

-   `apiDefinition` **[Object][97]** the complete API definition related to this operation

##### dataSource

###### Properties

-   `dataSource` **[Object][97]** the original operation datasource. Call this.dataSource(context) to get the compiled datasource template with the given context

##### exec

Executes the current operation flow with the given context and initial data
The dataSource is only compiled on the loader step\`

###### Parameters

-   `req` **[Object][97]** the context of the operation, usually the req object
-   `res` **[Object][97]** the response object
-   `initialData` **[Object][97]** the initial data to execute the first flow step (optional, default `{}`)

###### Examples

```javascript
const { services } = require('bautajs');
const express = require('express');
const app = express();

app.get('/blue', (req, res, next) => {
 services.cats.v1.find.exec(req, res).then((value) =>next(null, value)).catch(next);
})
```

Returns **[Promise][108]&lt;([Array][99]&lt;[object][97]> | [object][97]), [Error][109]>** resolves with the flow execution value, rejects with the flow execution error

##### operationId

###### Properties

-   `operationId` **[Object][97]** the operation id

##### push

Push an step/function to the end of the chain

###### Parameters

-   `step` **any** the step function, value or class

###### Examples

```javascript
//my-loader.js
const compileDataSource = require('bautajs/decorators/compile-data-source');

module.exports = (services) => {
 // Step can be a function that returns a promise
 services.cats.v1.find.push((previousValue) => Promise.resolve('myValue'));
 // Step can be a function that returns a value
 services.cats.v1.find.push((previousValue, ctx) =>{
   const req = ctx.req;
   return 'value';
 });
 // Step can be a function that returns a callback
 services.cats.v1.find.push((previousValue , ctx, done) => done(null, 'myValue'));
 // Step can be a value
 services.cats.v1.find.push('value');
 // Step can have pseudo decorators
 services.cats.v1.find.push(compileDataSource((_ , ctx) => {
   return ctx.dataSource.request();
 });
}
```

Returns **[Operation][110]** an instance of the operation

##### run

Run the steps chain from the given step index

###### Parameters

-   `index` **[number][111]** the step index
-   `value` **[Object][97]** the value to send to the step
-   `context` **[Object][97]** the context to send to the step

Returns **[Promise][108]&lt;([Array][99]&lt;[object][97]> | [object][97]), [Error][109]>** resolves with the step execution value, rejects with the step execution error

##### schema

###### Properties

-   `schema` **[Object][97]** operation OpenAPI schema

##### serviceId

###### Properties

-   `serviceId` **[Object][97]** the service id that this operation belongs

##### setErrorHandler

Set a custom error handler that will be executed in case of some loader is rejected

###### Parameters

-   `errorHandler` **[function][98]** the error handler function

###### Examples

```javascript
const { services } = require('bautajs');

services.cats.v1.find.setErrorHandler((err) => Promise.reject(err));
```

Returns **[Operation][110]** An instance of the operation

##### setSchema

Override the operation schema

###### Parameters

-   `schema` **[Object][97]** the [OpenAPI][87] path schema @see [https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#paths-object-example][112]

###### Examples

```javascript
const { services } = require('bautajs');
conmst mySchema = require('./some-schema.json');

services.cats.v1.find.setSchema(mySchema);
```

Returns **[Operation][110]** An instance of the operation

##### validateRequest

Validate the given request.

###### Parameters

-   `req` **any?** the request object. If not set the given context request will be validated.

###### Examples

```javascript
const { services } = require('bautajs');

services.cats.v1.find.previous(function(previousValue){
 const error = this.validateRequest();
 if(error) {
   throw error;
 }

 return 'value';
});
```

##### validateResponse

Validate the given response

###### Parameters

-   `response` **any** the response object.

###### Examples

```javascript
const { services } = require('bautajs');

services.cats.v1.find.next(function(response){
 const error = this.validateResponse(response);
 if(error) {
   this.logger.error(`Error on validate the response ${error}`);
   throw error;
 }

 return 'value';
});
```

#### Step

An Step instance is the representation of a function or a value. Is the smallest item of the chain.
The step gets as parameter the context and the previous step value and returns a promise a value or a callback.

##### Parameters

-   `step` **[function][98]** a function that returns a promise

##### handleValue

Return the step as a promise

###### Parameters

-   `value` **[Object][97]** the input value to send as a result

Returns **[Promise][108]&lt;([Array][99]&lt;[object][97]> | [object][97]), [Error][109]>** resolves with the step result, rejects with the step error

##### run

Run the step binding the given context and adding the given value, making accessible the context (req) by 'this'
inside the step function.
The step always returns a promise, but inside the step function you can return a value, promise or a callback.

###### Parameters

-   `ctx` **[Object][97]** the context bind to the step execution
-   `value` **[Object][97]** the input value to send to the step execution

##### runWithCallback

Execute the step and convert the callback returned into a promise

###### Parameters

-   `ctx` **[Object][97]** the context bind to the step execution
-   `value` **[Object][97]** the input value to send to the step execution

Returns **[Promise][108]&lt;([Array][99]&lt;[object][97]> | [object][97]), [Error][109]>** resolves with the step result, rejects with the step error

##### runWithReturn

Execute the step and covnert the simple result returned into a promise

###### Parameters

-   `ctx` **[Object][97]** the context bind to the step execution
-   `value` **[Object][97]** the input value to send to the step execution

Returns **[Promise][108]&lt;([Array][99]&lt;[object][97]> | [object][97]), [Error][109]>** resolves with the step result, rejects with the step error

#### Service

The Service is a set of [Version][77]

Type: [Object][97]

##### Parameters

-   `serviceId` **[string][102]** the service id
-   `datasourceTemplate` **[Object][97]** a dictionary of services with his operations @see [../validators/datasource-schema.json][113]
-   `apiDefinitions` **[Array][99]&lt;[Object][97]>** Array of [OpenAPI][87] definitions.
-   `optionals` **[Object][97]?** optional stuff

#### Version

The Version is a set of [Operation][33]

Type: [Object][97]

##### Parameters

-   `versionId` **[string][102]** the version name

##### addOperation

Create a new operation for the given version service. It is recomended to declare operations from the datasource and not using this method!

###### Parameters

-   `id` **[string][102]** The operation id
-   `operation` **[Operation][110]** The operation instance

###### Examples

```javascript
const { services, Operation } = require('bautajs');
const dataSourceTemplate = {
 id: 'find'
}
const apiDefinition = {
 versionId:"v1",
 openapi: "3.0",
 info: {
   title:"version 1",
   version: "1.0"
 }
}
const operation = new Operation('myaOperationId', [() => 'hellow world'], dataSourceTemplate, apiDefinition, serviceId: 'cats' )

services.cats.v1.addOperation(dataSourceTemplate.name, operation);
```

Returns **[Version][114]** An instance of the version

##### push

Push an step/function to the end of all version operations chain

###### Parameters

-   `step` **any** the step function, value or class

###### Examples

```javascript
//common-resolver.js
const compileDataSource = require('bautajs/decorators/compile-data-source');

module.exports = (services) => {
 // Step can be a function that returns a promise
 services.cats.v1.push((previousValue) => Promise.resolve('myValue'));
 // Step can be a function that returns a value
 services.cats.v1.push((previousValue, ctx) =>{
   const req = ctx.req;
   return 'value';
 });
 // Step can be a function that returns a callback
 services.cats.v1.push((previousValue , ctx, done) => done(null, 'myValue'));
 // Step can be a value
 services.cats.v1.push('value');
 // Step can have pseudo decorators
 services.cats.v1.push(compileDataSource((_ , ctx) => {
   return ctx.dataSource.request();
 });
}
```

Returns **[Version][114]** an instance of the operation

#### Logger

A logger instance of debug

Type: {debug, trace, log, info, warn, error, events, eventTypes}

[1]: #bautajs

[2]: #how-to-install

[3]: #features

[4]: #request-validation

[5]: #datasources

[6]: #multipartrelated-requests

[7]: #multipartform-data-requests

[8]: #request-like-features

[9]: #debug

[10]: #loopbackfilters

[11]: #api-versioning

[12]: #set-an-operation-schema-endpoint-schema

[13]: #decorators

[14]: #usage

[15]: #request

[16]: #parameters

[17]: #examples

[18]: #compiledatasource

[19]: #parameters-1

[20]: #examples-1

[21]: #public-api

[22]: #bautajs-1

[23]: #parameters-2

[24]: #examples-2

[25]: #logger

[26]: #properties

[27]: #requireall

[28]: #parameters-3

[29]: #examples-3

[30]: #services

[31]: #properties-1

[32]: #artifacts

[33]: #operation

[34]: #parameters-4

[35]: #apidefinition

[36]: #properties-2

[37]: #datasource

[38]: #properties-3

[39]: #exec

[40]: #parameters-5

[41]: #examples-4

[42]: #operationid

[43]: #properties-4

[44]: #push

[45]: #parameters-6

[46]: #examples-5

[47]: #run

[48]: #parameters-7

[49]: #schema

[50]: #properties-5

[51]: #serviceid

[52]: #properties-6

[53]: #seterrorhandler

[54]: #parameters-8

[55]: #examples-6

[56]: #setschema

[57]: #parameters-9

[58]: #examples-7

[59]: #validaterequest

[60]: #parameters-10

[61]: #examples-8

[62]: #validateresponse

[63]: #parameters-11

[64]: #examples-9

[65]: #step

[66]: #parameters-12

[67]: #handlevalue

[68]: #parameters-13

[69]: #run-1

[70]: #parameters-14

[71]: #runwithcallback

[72]: #parameters-15

[73]: #runwithreturn

[74]: #parameters-16

[75]: #service

[76]: #parameters-17

[77]: #version

[78]: #parameters-18

[79]: #addoperation

[80]: #parameters-19

[81]: #examples-10

[82]: #push-1

[83]: #parameters-20

[84]: #examples-11

[85]: #logger-1

[86]: https://axags.jfrog.io/axags/api/npm/virtual-bcn-node/

[87]: https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.0.md#specification

[88]: https://github.com/sindresorhus/got

[89]: ./lib/validators/datasource-schema.json

[90]: https://www.npmjs.com/package/stjs

[91]: https://github.com/request/request#multipartrelated

[92]: https://github.axa.com/Digital/bauta-nodejs/tree/master/packages/multipart-request-builder

[93]: https://github.com/pinojs/pino/blob/master/docs/redaction.md

[94]: https://loopback.io/doc/en/lb3/Querying-data.html

[95]: ./lib/validators/api-definition-schema.json

[96]: https://github.com/OAI/OpenAPI-Specification

[97]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[98]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[99]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[100]: https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.0.md

[101]: ./lib/validators/api-definition-schema-json

[102]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[103]: https://github.com/isaacs/node-glob

[104]: #logger

[105]: https://www.npmjs.com/package/debug

[106]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[107]: #service

[108]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[109]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error

[110]: #operation

[111]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[112]: https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#paths-object-example

[113]: ../validators/datasource-schema.json

[114]: #version
